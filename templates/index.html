<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ìƒí’ˆ ë¦¬ë·° ìš°ì„ ë„ ì¡°íšŒ</title>
    <style>
        body { font-family: 'Malgun Gothic', 'Arial', sans-serif; padding: 20px; background-color: #f4f7f6; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        h1 { color: #007bff; border-bottom: 2px solid #007bff; padding-bottom: 10px; }
        .controls { margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 8px; background: #e9ecef; display: flex; align-items: center; }
        label { font-weight: bold; margin-right: 10px; color: #333; }
        select { padding: 10px; margin-right: 20px; border: 1px solid #ccc; border-radius: 4px; font-size: 16px; cursor: pointer; }
        select:disabled { background-color: #f8f8f8; cursor: not-allowed; }
        #review-table-container { margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 15px; }
        th, td { border: 1px solid #dee2e6; padding: 15px; text-align: left; font-size: 14px; }
        th { background-color: #007bff; color: white; font-weight: 600; text-align: center; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        td:first-child { text-align: center; font-weight: bold; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ìƒí’ˆë³„ ë…¸ì¶œ ìš°ì„ ë„(Priority) ìƒìœ„ 10ê°œ ë¦¬ë·°</h1>

        <div class="controls">
            <label for="category-select">ğŸ“¦ ì¹´í…Œê³ ë¦¬:</label>
            <select id="category-select" onchange="loadProducts()">
                <option value="">-- ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                {% for category in categories %}
                    <option value="{{ category }}">{{ category }}</option>
                {% endfor %}
            </select>

            <label for="product-select">ğŸ›ï¸ ìƒí’ˆëª…:</label>
            <select id="product-select" onchange="showReviews()" disabled>
                <option value="">-- ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš” --</option>
            </select>
        </div>

        <div id="review-table-container">
            <p>ì¹´í…Œê³ ë¦¬ì™€ ìƒí’ˆì„ ì„ íƒí•˜ì‹œë©´, **ë…¸ì¶œ ìš°ì„ ë„(Priority) ìƒìœ„ 10ê°œ ë¦¬ë·°**ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>
        </div>
    </div>

    <script>
        let allReviewData = {}; 

        document.addEventListener('DOMContentLoaded', () => {
            fetch('/api/data')
                .then(response => response.json())
                .then(data => {
                    allReviewData = data;
                })
                .catch(error => {
                    console.error('Error loading review data:', error);
                    document.getElementById('review-table-container').innerHTML = 
                        '<p style="color:red;">ë°ì´í„° ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì„œë²„ì™€ JSON íŒŒì¼ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.</p>';
                });
        });

        function loadProducts() {
            const categorySelect = document.getElementById('category-select');
            const productSelect = document.getElementById('product-select');
            const selectedCategory = categorySelect.value;

            productSelect.innerHTML = '<option value="">-- ìƒí’ˆì„ ì„ íƒí•˜ì„¸ìš” --</option>';
            productSelect.disabled = true;
            document.getElementById('review-table-container').innerHTML = '<p>ìƒí’ˆì„ ì„ íƒí•˜ì‹œë©´, ë…¸ì¶œ ìš°ì„ ë„(Priority) ìƒìœ„ 10ê°œ ë¦¬ë·°ê°€ í‘œì‹œë©ë‹ˆë‹¤.</p>';

            if (selectedCategory && allReviewData[selectedCategory]) {
                const products = Object.keys(allReviewData[selectedCategory]);
                products.forEach(product => {
                    const option = document.createElement('option');
                    option.value = product;
                    option.textContent = product;
                    productSelect.appendChild(option);
                });
                productSelect.disabled = false;
            }
        }

        function showReviews() {
            const categorySelect = document.getElementById('category-select');
            const productSelect = document.getElementById('product-select');
            const reviewContainer = document.getElementById('review-table-container');

            const selectedCategory = categorySelect.value;
            const selectedProduct = productSelect.value;

            reviewContainer.innerHTML = ''; 

            if (selectedCategory && selectedProduct) {
                const reviews = allReviewData[selectedCategory][selectedProduct];

                if (reviews && reviews.length > 0) {
                    const tableHTML = generateReviewTable(reviews, selectedProduct);
                    reviewContainer.innerHTML = tableHTML;
                } else {
                    reviewContainer.innerHTML = `<p>ì„ íƒí•˜ì‹  ìƒí’ˆ(${selectedProduct})ì— ëŒ€í•œ ë¦¬ë·° ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>`;
                }
            }
        }

        function generateReviewTable(reviews, productName) {
            let html = `<h2>${productName} - ìƒìœ„ ${reviews.length}ê°œ ë¦¬ë·°</h2>`;
            html += '<table>';
            html += '<thead><tr><th>ìˆœìœ„</th><th>Review (ë¦¬ë·° ë‚´ìš©)</th><th>Priority (ìš°ì„ ë„)</th><th>LSM Score</th><th>Expertise</th></tr></thead>';
            html += '<tbody>';

            reviews.forEach((review, index) => {
                html += '<tr>';
                html += `<td>${index + 1}</td>`; 
                html += `<td>${review.Review}</td>`;
                html += `<td>${review.Priority.toFixed(2)}</td>`; 
                html += `<td>${review.LSM_Score.toFixed(4)}</td>`; 
                html += `<td>${review.Expertise}</td>`;
                html += '</tr>';
            });

            html += '</tbody></table>';
            return html;
        }
    </script>
</body>
</html>